<div class="container my-5 pb-5 border-bottom d-flex flex-column min-vh-100">
    <div class="row">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="fw-bold">User Management</h2>
          <div class="input-group w-50 shadow-sm">
            <input
              type="text"
              class="form-control border-0"
              placeholder="Search users..."
              [(ngModel)]="searchTerm"
              (input)="filterUsers()"
            />
            <button class="btn btn-primary" type="button" (click)="filterUsers()">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </div>
  
        <div *ngIf="paginatedUsers.length > 0; else noItems" class="table-responsive shadow-sm rounded">
          <table class="table table-striped table-hover table-nowrap align-middle">
            <thead class="table-dark">
              <tr>
                <th>#</th>
                <th>NAME</th>
                <th>EMAIL</th>
                <th>ROLE</th>
                <th>STATUS</th>
                <th *ngIf="isLoggedIn && isAdmin">ACTIONS</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of paginatedUsers; let i = index" class="cursor-pointer">
                <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
                <td (click)="navigateToUser(user.id)" class="text-primary">
                  {{ user.username }}
                </td>
                <td>{{ user.email }}</td>
                <td><span class="badge bg-secondary">{{ user.isAdmin ? 'Admin' : 'User' }}</span></td>
                <td>
                  <span
                    [class.badge]="true"
                    [class.bg-danger]="user.isBlocked"
                    [class.bg-success]="!user.isBlocked"
                    >{{ user.isBlocked ? 'Blocked' : 'Active' }}</span
                  >
                </td>
                <td *ngIf="isLoggedIn && isAdmin" (click)="$event.stopPropagation()">
                  <div ngbDropdown class="d-inline-block">
                    <button
                      class="btn btn-outline-secondary btn-sm dropdown-toggle"
                      ngbDropdownToggle
                    >
                      Actions
                    </button>
                    <div class="dropdown-menu dropdown-menu-end shadow-lg" ngbDropdownMenu>
                      <button
                        *ngIf="!user.isBlocked"
                        class="dropdown-item"
                        (click)="blockUser(user.id)"
                      >
                        <i class="bi bi-ban me-2"></i>Block
                      </button>
                      <button
                        *ngIf="user.isBlocked"
                        class="dropdown-item"
                        (click)="unblockUser(user.id)"
                      >
                        <i class="bi bi-unlock me-2"></i>Unblock
                      </button>
                      <button
                        *ngIf="!user.isAdmin"
                        class="dropdown-item"
                        (click)="upgradeToAdmin(user.id)"
                      >
                        <i class="bi bi-key me-2"></i>Make Admin
                      </button>
                      <button
                        *ngIf="user.isAdmin"
                        class="dropdown-item"
                        (click)="downgradeToUser(user.id)"
                      >
                        <i class="bi bi-person me-2"></i>Remove Admin
                      </button>
                      <button
                        class="dropdown-item text-danger"
                        (click)="deleteUser(user.id)"
                      >
                        <i class="bi bi-trash me-2"></i>Delete
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
  
        <nav *ngIf="totalPages > 1" class="mt-4">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" (click)="goToPage(currentPage - 1)">Previous</a>
            </li>
            <li
              class="page-item"
              *ngFor="
                let page of [].constructor(totalPages);
                let pageIndex = index
              "
              [class.active]="pageIndex + 1 === currentPage"
            >
              <a class="page-link" (click)="goToPage(pageIndex + 1)">
                {{ pageIndex + 1 }}
              </a>
            </li>
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <a class="page-link" (click)="goToPage(currentPage + 1)">Next</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
  
  <ng-template #noItems>
    <div
      class="alert alert-warning text-center h-100 d-flex align-items-center justify-content-center shadow-sm rounded"
      role="alert"
    >
      <i class="bi bi-exclamation-circle-fill me-2"></i>
      No User Found.
    </div>
  </ng-template>
  